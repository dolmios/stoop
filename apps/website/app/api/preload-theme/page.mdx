# preloadTheme

<Icon name="Lightning" size={24} style={{ display: "inline", verticalAlign: "middle", marginRight: "8px" }} /> Preload theme CSS variables before React renders to prevent FOUC (Flash of Unstyled Content)

## Usage

```typescript
import { preloadTheme } from "./theme";

// Parameter is required by TypeScript but ignored at runtime
// Always injects all themes configured in createStoop
preloadTheme("dark"); // or any value - parameter is ignored
```

## Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| theme | `string \| Theme` | **Required by TypeScript but ignored at runtime** - The function always injects CSS variables for **all** themes configured in `themes` config. Only works when `themes` config is provided to `createStoop`. |

## Preventing FOUC

When loading a non-default theme from localStorage, use `preloadTheme()` before React renders:

### Client Component Approach

```typescript
"use client";

import { useEffect, type ReactNode } from "react";
import { preloadTheme } from "./theme";

export default function RootLayout({ children }: { children: ReactNode }) {
  useEffect(() => {
    const savedTheme = localStorage.getItem("stoop-theme");
    if (savedTheme) {
      preloadTheme(savedTheme);
    }
  }, []);

  return <>{children}</>;
}
```

### Script Tag Approach (Recommended)

For a more robust solution, you can use a script tag. However, note that `preloadTheme()` must be available in the global scope. This typically requires exposing your Stoop instance:

```typescript
// stoop.theme.ts
import { createStoop } from "stoop";

const stoop = createStoop({
  theme: { /* ... */ },
  themes: { /* ... */ },
});

// Expose for script tag usage (optional)
if (typeof window !== "undefined") {
  (window as any).stoopPreloadTheme = stoop.preloadTheme;
}

export const { styled, css, Provider, useTheme, getCssText, preloadTheme } = stoop;
```

```typescript
// app/layout.tsx
import Script from "next/script";
import { type ReactNode } from "react";
import { getCssText } from "./stoop.theme";

export default function RootLayout({ children }: { children: ReactNode }) {
  return (
    <html>
      <head>
        <style
          id="stoop-styles"
          dangerouslySetInnerHTML={{ __html: getCssText() }}
        />
        <Script
          id="stoop-theme-preload"
          strategy="beforeInteractive"
          dangerouslySetInnerHTML={{
            __html: `
              (function() {
                const savedTheme = localStorage.getItem('stoop-theme');
                if (savedTheme && typeof window.stoopPreloadTheme === 'function') {
                  window.stoopPreloadTheme(savedTheme);
                }
              })();
            `,
          }}
        />
      </head>
      <body>{children}</body>
    </html>
  );
}
```

**Note**: The Provider component automatically handles theme preloading, so manual `preloadTheme()` calls are usually not needed.

## Notes

- The Provider component automatically handles theme preloading - manual calls are usually not needed
- Must be called before React renders if used manually (use `beforeInteractive` script strategy or in a script tag)
- Injects CSS variables for **all** configured themes synchronously using attribute selectors
- The `theme` parameter is required by TypeScript but ignored at runtime - all themes are always injected
- Only works when `themes` config is provided to `createStoop`

